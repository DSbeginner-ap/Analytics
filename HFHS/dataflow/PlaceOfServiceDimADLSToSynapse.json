{
	"name": "PlaceOfServiceDimADLSToSynapse",
	"properties": {
		"description": "Pipeline to Integrate Data from ADLS to Synapse",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "PlaceOfServiceDimReporting",
						"type": "DatasetReference"
					},
					"name": "PlaceOfServiceDimReporting"
				},
				{
					"dataset": {
						"referenceName": "PlaceOfServiceDimReporting",
						"type": "DatasetReference"
					},
					"name": "MaxSurrogateKey"
				},
				{
					"dataset": {
						"referenceName": "PlaceOfserviceDimIdLookUp",
						"type": "DatasetReference"
					},
					"name": "PlaceOfServiceDimIdLookUp"
				},
				{
					"dataset": {
						"referenceName": "ParquetPlaceOfservice",
						"type": "DatasetReference"
					},
					"name": "SourcePlaceOfService"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "IdIdTypeDoesNotExists"
				},
				{
					"name": "CDCValue"
				},
				{
					"name": "JoinSurrogateKey"
				},
				{
					"name": "NewSurrogateKey"
				},
				{
					"name": "NewPlaceOfserviceKey"
				}
			],
			"script": "source(output(\n\t\tPlaceOfServiceKey as integer,\n\t\tPlaceOfServiceEpicId as string,\n\t\tName as string,\n\t\tDisplayName as string,\n\t\tType as string,\n\t\tFacilityType as string,\n\t\tLocationCcn as string,\n\t\tPhoneNumber as string,\n\t\tAddress as string,\n\t\tCity as string,\n\t\tStateOrProvince as string,\n\t\tPostalCode as string,\n\t\tCounty as string,\n\t\tCountry as string,\n\t\tEmailAddress as string,\n\t\tWebAddress as string,\n\t\tCreatedTimeStamp as timestamp,\n\t\tUpdatedTimeStamp as timestamp,\n\t\tMD5Hash as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT * FROM dbo.PlaceOfServiceDim',\n\tformat: 'query',\n\tstaged: false) ~> PlaceOfServiceDimReporting\nsource(output(\n\t\tPlaceOfServiceKey as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT MAX(PlaceOfServiceKey) AS MaxSurrogateKey\\nFROM dbo.PlaceOfServiceDim',\n\tformat: 'query',\n\tstaged: false) ~> MaxSurrogateKey\nsource(output(\n\t\tPlaceOfServiceKey as integer,\n\t\tId as string,\n\t\tIdType as string,\n\t\tCreatedTimeStamp as timestamp,\n\t\tUpdatedTimeStamp as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT * FROM dbo.[PlaceOfServiceDim_IdLookup]',\n\tformat: 'query',\n\tstaged: false) ~> PlaceOfServiceDimIdLookUp\nsource(output(\n\t\tId as string,\n\t\tIdType as string,\n\t\tPlaceOfServiceEpicId as string,\n\t\tName as string,\n\t\tDisplayName as string,\n\t\tType as string,\n\t\tFacilityType as string,\n\t\tLocationCcn as string,\n\t\tPhoneNumber as string,\n\t\tAddress as string,\n\t\tCity as string,\n\t\tStateOrProvince as string,\n\t\tPostalCode as string,\n\t\tCounty as string,\n\t\tCountry as string,\n\t\tEmailAddress as string,\n\t\tWebAddress as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> SourcePlaceOfService\nSourcePlaceOfService, PlaceOfServiceDimIdLookUp exists(SourcePlaceOfService@Id == PlaceOfServiceDimIdLookUp@Id\n\t&& SourcePlaceOfService@IdType == PlaceOfServiceDimIdLookUp@IdType,\n\tnegate:true,\n\tbroadcast: 'auto')~> IdIdTypeDoesNotExists\nIdIdTypeDoesNotExists derive(CDCValue = md5(Name, DisplayName, Type, FacilityType, LocationCcn, PhoneNumber, Address, City, StateOrProvince, PostalCode, County, Country, EmailAddress, WebAddress)) ~> CDCValue\nCDCValue, MaxSurrogateKey join(true(),\n\tjoinType:'cross',\n\tbroadcast: 'auto')~> JoinSurrogateKey\nJoinSurrogateKey keyGenerate(output(S_Key as long),\n\tstartAt: 1L) ~> NewSurrogateKey\nNewSurrogateKey derive(PlaceOfServiceKey_Calculated = MaxSurrogateKey+s_key) ~> NewPlaceOfserviceKey"
		}
	}
}