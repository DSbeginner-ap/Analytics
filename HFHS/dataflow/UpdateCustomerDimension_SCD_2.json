{
	"name": "UpdateCustomerDimension_SCD_2",
	"properties": {
		"description": "Import Data From Customer Source.",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "CustomerSourceADLS",
						"type": "DatasetReference"
					},
					"name": "SourceDB"
				},
				{
					"dataset": {
						"referenceName": "DimCustomer_2",
						"type": "DatasetReference"
					},
					"name": "DimCustomer"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "CreateCustomerHash"
				},
				{
					"name": "RenameSourceColumns"
				},
				{
					"name": "FilterForActive"
				},
				{
					"name": "AddHashExisting"
				},
				{
					"name": "NewAndUpdatedRows"
				}
			],
			"script": "parameters{\n\tPrimaryKey as string ('src_CustomerID'),\n\tColumns as string ('src_FirstName,src_MiddleName,src_LastName')\n}\nsource(output(\n\t\tCustomerID as integer,\n\t\tTitle as string,\n\t\tFirstName as string,\n\t\tMiddleName as string,\n\t\tLastName as string,\n\t\tSuffix as string,\n\t\tCompanyName as string,\n\t\tSalesPerson as string,\n\t\tEmailAddress as string,\n\t\tPhone as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> SourceDB\nsource(output(\n\t\tCustomerKey as integer,\n\t\tCustomerID as integer,\n\t\tTitle as string,\n\t\tFirstName as string,\n\t\tMiddleName as string,\n\t\tLastName as string,\n\t\tSuffix as string,\n\t\tCompanyName as string,\n\t\tSalesPerson as string,\n\t\tEmailAddress as string,\n\t\tPhone as string,\n\t\tStartDate as timestamp,\n\t\tEndDate as date,\n\t\tModifiedDate as date,\n\t\tIsCurrent as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> DimCustomer\nRenameSourceColumns derive(Id_Hash = md5(byName($PrimaryKey)),\n\t\tColumns_Hash = md5(byNames(split($Columns, ',')))) ~> CreateCustomerHash\nSourceDB select(mapColumn(\n\t\tsrc_CustomerID = CustomerID,\n\t\tsrc_Title = Title,\n\t\tsrc_FirstName = FirstName,\n\t\tsrc_MiddleName = MiddleName,\n\t\tsrc_LastName = LastName,\n\t\tsrc_Suffix = Suffix,\n\t\tsrc_CompanyName = CompanyName,\n\t\tsrc_SalesPerson = SalesPerson,\n\t\tsrc_EmailAddress = EmailAddress,\n\t\tsrc_Phone = Phone\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RenameSourceColumns\nDimCustomer filter(toInteger(byName('IsCurrent')) == 1) ~> FilterForActive\nFilterForActive derive(Id_Hash = md5(byNames(split($PrimaryKey, ','))),\n\t\tColumns_Hash = md5(byNames(split($Columns, ',')))) ~> AddHashExisting\nCreateCustomerHash, AddHashExisting exists(CreateCustomerHash@Id_Hash == AddHashExisting@Id_Hash\n\t&& CreateCustomerHash@Columns_Hash == AddHashExisting@Columns_Hash,\n\tnegate:true,\n\tbroadcast: 'auto')~> NewAndUpdatedRows"
		}
	}
}